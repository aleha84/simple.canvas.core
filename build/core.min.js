function Box(n,t){this.topLeft=n;this.size=t;this.center=new Vector2(this.topLeft.x+t.x/2,this.topLeft.y+t.y/2);this.bottomRight=new Vector2(this.topLeft.x+this.size.x,this.topLeft.y+this.size.y);this.topRight=new Vector2(this.bottomRight.x,this.topLeft.y);this.bottomLeft=new Vector2(this.topLeft.x,this.bottomRight.y);this.update=function(n,t){this.topLeft=n;t!==undefined&&(this.size=t);this.center=new Vector2(this.topLeft.x+this.size.x/2,this.topLeft.y+this.size.y/2);this.bottomRight=new Vector2(this.topLeft.x+this.size.x,this.topLeft.y+this.size.y)};this.isPointInside=function(n){return n instanceof Vector2&&this.topLeft.x<=n.x&&n.x<=this.bottomRight.x&&this.topLeft.y<=n.y&&n.y<=this.bottomRight.y};this.isIntersectsWithCircle=function(n){return boxCircleIntersects(n,this)};this.isIntersectsWithBox=function(n){return boxIntersectsBox(this,n)};this.render=function(n){var t={fillStyle:"rgba(0, 255, 0, 0.5)",lineWidth:1,strokeStyle:"#00FF00"};isBoolean(n)?t.fill=n:extend(t,n);SCG.context.beginPath();SCG.context.rect(this.topLeft.x,this.topLeft.y,this.size.x,this.size.y);t.fill&&(SCG.context.fillStyle=t.fillStyle,SCG.context.fill());SCG.context.lineWidth=t.lineWidth;SCG.context.strokeStyle=t.strokeStyle;SCG.context.closePath();SCG.context.stroke()}}function Circle(n,t){n instanceof Vector2?(this.center=n,this.radius=t):n instanceof Object&&n.center!==undefined&&n.radius!==undefined&&(this.center=n.center,this.radius=n.radius);this.update=function(n){this.radius=n};this.render=function(n,t){var i={fillStyle:"rgba(255, 255, 0, 0.5)",lineWidth:1,strokeStyle:"#FFFF00"};isBoolean(n)?i.fill=n:extend(i,n);t!==undefined&&isString(t)&&(i.fillStyle=t,i.strokeStyle=t);SCG.context.beginPath();SCG.context.arc(this.center.x,this.center.y,this.radius,0,2*Math.PI,!1);i.fill&&(SCG.context.fillStyle=i.fillStyle,SCG.context.fill());SCG.context.lineWidth=i.lineWidth;SCG.context.strokeStyle=i.strokeStyle;SCG.context.stroke()};this.clone=function(){return new Circle(this.center,this.radius)}}function Line(n){this.begin=new Vector2;this.end=new Vector2;this.color="#ffffff";this.width=1;extend(this,n);this.render=function(){SCG.context.beginPath();SCG.context.moveTo(this.begin.x,this.begin.y);SCG.context.lineTo(this.end.x,this.end.y);SCG.context.lineWidth=this.width;SCG.context.strokeStyle=this.color;SCG.context.stroke()};this.update=function(n){extend(this,n)};this.calculateBoundingSphere=function(){var n=new Vector2((this.end.x-this.begin.x)/2,(this.end.y-this.begin.y)/2),t=this.begin.distance(this.end)/2;return new Circle(n,t)};this.calculateBoundingBox=function(){var n=new Vector2,t;return n.x=this.begin.x<this.end.x?this.begin.x:this.end.x,n.y=this.begin.y<this.end.y?this.begin.y:this.end.y,t=new Vector2(Math.abs(this.end.x-this.begin.x),Math.abs(this.end.y-this.begin.x)),new Box(n,t)}}function Poligon(n){if(this.vertices=n.vertices,this.renderOptions=n.renderOptions,this.defaults={fillStyle:"rgba(255, 255, 0, 0.5)",strokeStyle:"#FF0000",lineWidth:2,fill:!1},this.vertices.length<3)throw"Poligon -> vertices lenght mustbe >= 3";this.renderOptions||(this.renderOptions={});this.renderOptions.fillStyle?this.defaults.fillStyle=this.renderOptions.fillStyle:this.renderOptions.fillStyle=this.defaults.fillStyle;this.renderOptions.lineWidth?this.defaults.lineWidth=this.renderOptions.lineWidth:this.renderOptions.lineWidth=this.defaults.lineWidth;this.renderOptions.strokeStyle?this.defaults.strokeStyle=this.renderOptions.strokeStyle:this.renderOptions.strokeStyle=this.defaults.strokeStyle;this.renderOptions.fill?this.defaults.fill=this.renderOptions.fill:this.renderOptions.fill=this.defaults.fill;this.resetToDefaults=function(){this.renderOptions.fillStyle=this.defaults.fillStyle;this.renderOptions.strokeStyle=this.defaults.strokeStyle;this.renderOptions.lineWidth=this.defaults.lineWidth;this.renderOptions.fill=this.defaults.fill};this.clone=function(){return new Poligon({vertices:this.vertices.map(function(n){return n.clone()})})};this.update=function(n,t){for(var i=this.vertices.length-1;i>=0;i--)this.vertices[i].rotate(t,!0,!0),this.vertices[i].add(n,!0)};this.render=function(){SCG.context.beginPath();SCG.context.moveTo(this.vertices[0].x,this.vertices[0].y);for(var n=1;n<this.vertices.length;n++)SCG.context.lineTo(this.vertices[n].x,this.vertices[n].y);SCG.context.lineWidth=this.renderOptions.lineWidth;SCG.context.strokeStyle=this.renderOptions.strokeStyle;SCG.context.closePath();this.renderOptions.fill&&(SCG.context.fillStyle=this.renderOptions.fillStyle,SCG.context.fill());SCG.context.stroke()};this.isPointInside=function(n){for(var r,u,f=0,i=n.x,t=0;t<this.vertices.length;t++)this.vertices[t].x>i&&(i=this.vertices[t].x);for(i+=1,t=0;t<this.vertices.length;t++)r=this.vertices[t].clone(),u=this.vertices[t==this.vertices.length-1?0:t+1].clone(),n.y==r.y&&(r.y-=.01),n.y==u.y&&(u.y-=.01),segmentsIntersectionVector2(new Line({begin:n,end:new Vector2(i,n.y)}),new Line({begin:r,end:u}))&&f++;return f>0&&f%2!=0}}function getRandom(n,t){return Math.random()*(t-n)+n}function getRandomInt(n,t){return Math.round(getRandom(n,t))}function boxIntersectsBox(n,t){return Math.abs(n.center.x-t.center.x)*2<n.size.x+t.size.x&&Math.abs(n.center.y-t.center.y)*2<n.size.y+t.size.y}function boxCircleIntersects(n,t){var i=new Vector2(Math.abs(n.center.x-t.center.x),Math.abs(n.center.y-t.center.y)),r;return i.x>t.size.x/2+n.radius?!1:i.y>t.size.y/2+n.radius?!1:i.x<=t.size.x/2?!0:i.y<=t.size.y/2?!0:(r=Math.pow(i.x-t.size.x/2,2)+Math.pow(i.y-t.size.y/2,2),r<=Math.pow(n.radius,2))}function segmentIntersectBox(n,t){var u=n.begin.x,f=n.end.x,e,o,h;if(n.begin.x>n.end.x&&(u=n.end.x,f=n.begin.x),f>t.bottomRight.x&&(f=t.bottomRight.x),u<t.topLeft.x&&(u=t.topLeft.x),u>f)return!1;var i=n.begin.y,r=n.end.y,s=n.end.x-n.begin.x;return(Math.abs(s)>1e-7&&(e=(n.end.y-n.begin.y)/s,o=n.begin.y-e*n.begin.x,i=e*u+o,r=e*f+o),i>r&&(h=r,r=i,i=h),r>t.bottomRight.y&&(r=t.bottomRight.y),i<t.topLeft.y&&(i=t.topLeft.y),i>r)?!1:!0}function segmentIntersectCircle(n,t){var u=n.end.substract(n.begin,!0),f=n.begin.substract(t.center,!0),e=u.dot(u),r=2*f.dot(u),h=f.dot(f)-Math.pow(t.radius,2),i=r*r-4*e*h,o,s;return i<0?!1:(i=Math.sqrt(i),o=(-r-i)/(2*e),s=(-r+i)/(2*e),o>=0&&o<=1)?!0:s>=0&&s<=1?!0:!1}function segmentIntersectCircle2(n,t){var i=t.center.distance(n.begin),r=t.center.distance(n.end);return i<=t.radius||r<=t.radius}function segmentsIntersectionVector2(n,t){var i=+n.begin.x.toFixed(2),r=+n.end.x.toFixed(2),u=+n.begin.y.toFixed(2),f=+n.end.y.toFixed(2),e=+t.begin.x.toFixed(2),o=+t.end.x.toFixed(2),s=+t.begin.y.toFixed(2),h=+t.end.y.toFixed(2),a=(i-r)*(s-h)-(u-f)*(e-o);if(a==0)return undefined;var c=+(((e-o)*(i*f-u*r)-(i-r)*(e*h-s*o))/a).toFixed(2),l=+(((s-h)*(i*f-u*r)-(u-f)*(e*h-s*o))/a).toFixed(2),v=new Vector2(c,l);return c<Math.min(i,r)||c>Math.max(i,r)?undefined:c<Math.min(e,o)||c>Math.max(e,o)?undefined:l<Math.min(u,f)||l>Math.max(u,f)?undefined:l<Math.min(s,h)||l>Math.max(s,h)?undefined:v}function segmentsIntersection(n,t){var i=n.begin.directionNonNormal(t.begin),r=n.begin.directionNonNormal(n.end),u=t.begin.directionNonNormal(t.end),f=i.x*r.y-i.y*r.x,c=i.x*u.y-i.y*u.x,e=r.x*u.y-r.y*u.x;if(f==0)return t.begin.x-n.begin.x<0!=t.begin.x-n.end.x<0||t.begin.y-n.begin.y<0!=t.begin.y-n.end.y<0;if(e==0)return!1;var o=1/e,s=c*o,h=f*o;return s>=0&&s<=1&&h>=0&&h<=1}function radiansToDegree(n){return n===undefined?0:n*180/Math.PI}function degreeToRadians(n){return n===undefined?0:n*Math.PI/180}function isBoolean(n){return n.constructor===Boolean||typeof n=="boolean"}function isString(){return typeof myVar=="string"||myVar instanceof String}function isArray(n){return Object.prototype.toString.call(n)==="[object Array]"}function isFunction(n){return typeof n=="function"}function absorbTouchEvent(n){if(n.type=="touchstart"||n.type=="touchmove"||n.type=="touchend"||n.type=="touchcancel"){var t=n||window.event;return t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0,t.returnValue=!1,!1}}function checkClamps(n,t){return!isArray(n)||isEmpty(n)?1:(t>n[1]?t=n[1]:t<n[0]&&(t=n[0]),t==n[0]||t==n[1])?-1:1}function isBetween(n,t,i){if(t>i){var r=i;i=t;t=r}return n>=t&&n<=i}function isEmpty(n){if(n==null)return!0;if(n.length>0)return!1;if(n.length===0)return!0;for(var t in n)if(hasOwnProperty.call(n,t))return!1;return!0}function sqr(n){return n*n}function dist2(n,t){return sqr(n.x-t.x)+sqr(n.y-t.y)}function distToSegmentSquared(n,t,i){var u=dist2(t,i),r;return u==0?dist2(n,t):(r=((n.x-t.x)*(i.x-t.x)+(n.y-t.y)*(i.y-t.y))/u,r<0)?dist2(n,t):r>1?dist2(n,i):dist2(n,{x:t.x+r*(i.x-t.x),y:t.y+r*(i.y-t.y)})}function distToSegment(n,t,i){return Math.sqrt(distToSegmentSquared(n,t,i))}function getDegreeToVectorUp(n,t){var i=Vector2.up(),r=t.substract(n,!0);return Math.acos(r.mulVector(i)/(r.module()*i.module()))}function doWorkByTimer(n,t){if(SCG.gameLogics.isPaused){n.lastTimeWork=t;n.delta=0;return}n.delta=t-n.lastTimeWork;SCG.gameLogics.pauseDelta!=0&&(n.delta-=SCG.gameLogics.pauseDelta);n.currentDelay-=n.delta;n.currentDelay<=0&&(n.currentDelay=n.originDelay,n.doWorkInternal.call(n.context));n.lastTimeWork=t}function extend(){var f,u,i,t,e,o,n=arguments[0]||{},r=1,h=arguments.length,s=!1;for(typeof n=="boolean"&&(s=n,n=arguments[r]||{},r++),typeof n=="object"||isFunction(n)||(n={}),r===h&&(n=this,r--);r<h;r++)if((f=arguments[r])!=null)for(u in f)(i=n[u],t=f[u],n!==t)&&(s&&t&&(isPlainObject(t)||(e=isArray(t)))?(e?(e=!1,o=i&&isArray(i)?i:[]):o=i&&isPlainObject(i)?i:{},n[u]=extend(s,o,t)):t!==undefined&&(n[u]=t));return n}function isPlainObject(n){var t,i,f=Object.prototype.toString,r=Object.prototype.hasOwnProperty,u=r.toString,e=u.call(Object);return!n||f.call(n)!=="[object Object]"?!1:(t=getProto(n),!t)?!0:(i=r.call(t,"constructor")&&t.constructor,typeof i=="function"&&u.call(i)===e)}function getDOMByClassName(n){var t=undefined,i=document.getElementsByClassName(n);return i.length>0&&(t=i[0]),t}function appendDomElement(n,t,i){if(!(n instanceof HTMLElement)&&!(n instanceof HTMLDocument)&&!(n instanceof HTMLBodyElement))throw"Cant append new element to non html Node";if(t!=undefined&&typeof t!="string")throw"Type must be a string";var r=document.createElement(t);return setAttributes(r,i),n.appendChild(r),r}function setAttributes(n,t){var i,r,u,f,e;for(i in t)if(t.hasOwnProperty(i))if(i=="on"){r=t[i];for(u in r)r.hasOwnProperty(u)&&n.addEventListener(u,r[u],!1)}else if(i=="css"){f=t[i];for(e in f)f.hasOwnProperty(e)&&(n.style[e]=f[e])}else n.setAttribute(i,t[i])}function addListenerMulti(n,t,i){t.split(" ").forEach(function(t){n.addEventListener(t,i,!1)})}function Vector2(n,t){n==undefined&&(n=0);t==undefined&&(t=0);this.x=n;this.y=t}var pointerEventToXY,getProto,SCG;(function(){"use strict";var i=typeof module!="undefined"&&module.exports,r=typeof Element!="undefined"&&"ALLOW_KEYBOARD_INPUT"in Element,n=function(){for(var t,r,i=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n=0,f=i.length,u={};n<f;n++)if(t=i[n],t&&t[1]in document){for(n=0,r=t.length;n<r;n++)u[i[0][n]]=t[n];return u}return!1}(),t={request:function(t){var i=n.requestFullscreen;t=t||document.documentElement;/5\.1[\.\d]* Safari/.test(navigator.userAgent)?t[i]():t[i](r&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){document[n.exitFullscreen]()},toggle:function(n){this.isFullscreen?this.exit():this.request(n)},raw:n};if(!n){i?module.exports=!1:window.screenfull=!1;return}Object.defineProperties(t,{isFullscreen:{get:function(){return!!document[n.fullscreenElement]}},element:{enumerable:!0,get:function(){return document[n.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return!!document[n.fullscreenEnabled]}}});i?module.exports=t:window.screenfull=t})();String.format||(String.format=function(n){var t=Array.prototype.slice.call(arguments,1);return n.replace(/{(\d+)}/g,function(n,i){return typeof t[i]!="undefined"?t[i]:n})});pointerEventToXY=function(n){var t={x:0,y:0},i;return n.type=="touchstart"||n.type=="touchmove"||n.type=="touchend"||n.type=="touchcancel"?(i=n.touches[0]||n.changedTouches[0],t.x=i.pageX,t.y=i.pageY):(n.type=="mousedown"||n.type=="mouseup"||n.type=="mousemove"||n.type=="mouseover"||n.type=="mouseout"||n.type=="mouseenter"||n.type=="mouseleave"||n.type=="click")&&(t.x=n.pageX,t.y=n.pageY),t};getProto=Object.getPrototypeOf||function(n){return n.__proto__};Vector2.prototype={distance:function(n){return!n||!(n instanceof Vector2)?undefined:new Vector2(n.x-this.x,n.y-this.y).module()},directionNonNormal:function(n){return!n||!(n instanceof Vector2)?new Vector2:new Vector2(n.x-this.x,n.y-this.y)},direction:function(n){return!n||!(n instanceof Vector2)?new Vector2:new Vector2(n.x-this.x,n.y-this.y).normalize()},normalize:function(){var n=this.module();return this.x/=n,this.y/=n,this},module:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},add:function(n,t){return t===undefined&&(t=!1),n instanceof Vector2?t?(this.x+=n.x,this.y+=n.y,this):new Vector2(this.x+n.x,this.y+n.y):void 0},substract:function(n,t){return(t===undefined&&(t=!1),n instanceof Vector2)?t?(this.x-=n.x,this.y-=n.y,this):new Vector2(this.x-n.x,this.y-n.y):new Vector2},mul:function(n){return new Vector2(this.x*n,this.y*n)},division:function(n){return new Vector2(this.x/n,this.y/n)},dot:function(n){return this.mulVector(n)},cross:function(n){return!n||!(n instanceof Vector2)?0:this.x*n.y-this.y*n.x},mulVector:function(n){return!n||!(n instanceof Vector2)?0:this.x*n.x+this.y*n.y},rotate:function(n,t,i){t===undefined&&(t=!1);i===undefined&&(i=!1);var r=new Vector2(this.x*Math.cos(t?n:n*Math.PI/180)-this.y*Math.sin(t?n:n*Math.PI/180),this.x*Math.sin(t?n:n*Math.PI/180)+this.y*Math.cos(t?n:n*Math.PI/180));return i?(this.x=r.x,this.y=r.y,this):r},clone:function(){return new Vector2(this.x,this.y)},equal:function(n){return!n||!(n instanceof Vector2)?!1:this.x==n.x&&this.y==n.y},toString:function(){return"x: "+this.x+", y: "+this.y},angleTo:function(n,t){if(!n||!(n instanceof Vector2))throw"Param is not a vetor2 instance";t==undefined&&(t=!1);var i=Math.atan2(this.cross(n),this.dot(n));return t?i:i*180/Math.PI}};Vector2.average=function(n){var i,t;if(!isArray(n)||isEmpty(n))throw"Param is not defined";for(i=new Vector2,t=0;t<n.length;t++)i.add(n[t],!0);return i.division(n.length)};Vector2.left=function(){return new Vector2(-1,0)};Vector2.right=function(){return new Vector2(1,0)};Vector2.up=function(){return new Vector2(0,-1)};Vector2.down=function(){return new Vector2(0,1)};SCG={test:"test"};SCG.AI={};SCG.space=undefined;SCG.viewfield={"default":{width:500,height:300},width:500,height:300,current:undefined};SCG.canvas=undefined;SCG.canvasId="mainCanvas";SCG.canvasBg=undefined;SCG.canvasBgId="backgroundCanvas";SCG.canvasUI=undefined;SCG.canvasUIId="uiCanvas";SCG.context=undefined;SCG.contextBg=undefined;SCG.contextUI=undefined;SCG.gameLogics={isPaused:!1,isPausedStep:!1,gameOver:!1,drawBoundings:!0,fillBoundings:!1,wrongDeviceOrientation:!1,messageToShow:"",isMobile:!1,pausedFrom:undefined,pauseDelta:0,doPauseWork:function(n){this.isPaused&&this.pausedFrom==undefined?(this.pausedFrom=n,this.pauseDelta=0):this.pausedFrom==undefined||this.isPaused?this.pauseDelta!=0&&(this.pauseDelta=0):(this.pauseDelta=n-this.pausedFrom,this.pausedFrom=undefined)}};SCG.go=[];SCG.gameControls={scale:{times:1},selectedGOs:[],camera:{mode:"free",shiftSpeed:5,centeredOn:undefined,shifts:{left:!1,right:!1,up:!1,down:!1},free:function(){SCG.gameControls.camera.mode="free";this.centeredOn=undefined},center:function(){SCG.gameControls.selectedGOs.length==1?(SCG.gameControls.camera.mode="centered",this.centeredOn=SCG.gameControls.selectedGOs[0]):(SCG.gameControls.camera.mode="free",this.centeredOn=undefined)},reset:function(){this.shifts.left=!1;this.shifts.right=!1;this.shifts.up=!1;this.shifts.down=!1},update:function(){var n,i,t,r;this.mode==="free"?(n=undefined,this.shifts.left&&(n=Vector2.left()),this.shifts.right&&(n=Vector2.right()),this.shifts.up&&(n!=undefined?n.add(Vector2.up()):n=Vector2.up()),this.shifts.down&&(n!=undefined?n.add(Vector2.down()):n=Vector2.down()),n!==undefined&&(i=n.mul(this.shiftSpeed),t=SCG.viewfield.current.topLeft.clone(),t.add(i),SCG.viewfield.current.update(t))):this.mode==="centered"&&this.centeredOn!==undefined&&(r=this.centeredOn.position.substract(new Vector2(SCG.viewfield.width/2,SCG.viewfield.height/2),!0),SCG.viewfield.current.update(r))}},mousestate:{position:new Vector2,delta:new Vector2,leftButtonDown:!1,rightButtonDown:!1,middleButtonDown:!1,timer:undefined,reset:function(){this.leftButtonDown=!1;this.rightButtonDown=!1;this.middleButtonDown=!1},stopped:function(){SCG.gameControls.mousestate.delta=new Vector2},toString:function(){return"position: "+this.position.toString()+"<br/>leftButtonDown: "+this.leftButtonDown},doClickCheck:function(){for(var n,i,t=0;t<this.eventHandlers.click.length;t++)if(n=this.eventHandlers.click[t],n.renderBox!=undefined&&n.renderBox.isPointInside(SCG.gameControls.mousestate.position)&&n.handlers!=undefined&&n.handlers.click!=undefined&&isFunction(n.handlers.click)){if(i=n.handlers.click.call(n),i&&i.preventBubbling)return;break}SCG.scenes.activeScene.game.clickHandler!=undefined&&isFunction(SCG.scenes.activeScene.game.clickHandler)&&SCG.scenes.activeScene.game.clickHandler(SCG.gameControls.mousestate.position.division(SCG.gameControls.scale.times))},eventHandlers:{click:[]}},keyboardstate:{altPressed:!1,shiftPressed:!1,ctrlPressed:!1},mouseDown:function(n){if(n.type=="touchstart")n.originalEvent.changedTouches!=undefined&&n.originalEvent.changedTouches.length==1&&(SCG.gameControls.mousestate.leftButtonDown=!0);else switch(n.which){case 1:SCG.gameControls.mousestate.leftButtonDown=!0;break;case 2:SCG.gameControls.mousestate.middleButtonDown=!0;break;case 3:SCG.gameControls.mousestate.rightButtonDown=!0;break;default:SCG.gameControls.mousestate.reset()}},mouseOut:function(){SCG.gameControls.mousestate.reset()},mouseUp:function(n){var t=this;if(t.getEventAbsolutePosition(n),n.type=="touchstart")n.originalEvent.changedTouches!=undefined&&n.originalEvent.changedTouches.length==1&&(SCG.gameControls.mousestate.leftButtonDown=!1);else switch(n.which){case 1:SCG.gameControls.mousestate.leftButtonDown=!1;break;case 2:SCG.gameControls.mousestate.middleButtonDown=!1;break;case 3:SCG.gameControls.mousestate.rightButtonDown=!1;break;default:SCG.gameControls.mousestate.reset()}t.mousestate.doClickCheck();n.preventDefault()},mouseMove:function(n){var t=this,i=SCG.gameControls.mousestate.position.clone();t.getEventAbsolutePosition(n);SCG.gameControls.mousestate.delta=SCG.gameControls.mousestate.position.substract(i);SCG.debugger.setValue(SCG.gameControls.mousestate.toString())},getEventAbsolutePosition:function(n){var t=pointerEventToXY(n);SCG.gameControls.mousestate.position=new Vector2(t.x-SCG.canvasUI.margins.left,t.y-SCG.canvasUI.margins.top)},orientationChangeEventInit:function(){var n=this;SCG.gameControls.permanentEventInit();addListenerMulti(window,"orientationchange resize",function(){n.graphInit()});SCG.gameLogics.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);SCG.gameLogics.isMobile&&(setTimeout(function(){window.scrollTo(0,1)},100),addListenerMulti(document,"fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",function(){n.graphInit()}));this.graphInit()},graphInit:function(){var u,n,t;if(SCG.gameLogics.messageToShow="",SCG.gameLogics.wrongDeviceOrientation=!window.matchMedia("(orientation: landscape)").matches,SCG.gameLogics.wrongDeviceOrientation){SCG.gameLogics.messageToShow="wrong device orientation - portrait";return}if(u=window.innerWidth,u<SCG.viewfield.default.width){SCG.gameLogics.messageToShow=String.format("width lesser than {3} (width: {0}, iH: {1}, iW: {2})",u,window.innerHeight,window.innerWidth,SCG.viewfield.default.width);SCG.gameLogics.wrongDeviceOrientation=!0;return}var i=Math.max(document.documentElement.clientWidth,window.innerWidth||0),r=Math.max(document.documentElement.clientHeight,window.innerHeight||0),f=i/SCG.viewfield.default.width,e=r/SCG.viewfield.default.height;if(SCG.gameControls.scale.times=Math.min(f,e),SCG.gameControls.scale.times<1){SCG.gameLogics.messageToShow=String.format("window is to small (width: {0}, height: {1})",i,r);SCG.gameLogics.wrongDeviceOrientation=!0;return}SCG.viewfield.width=SCG.viewfield.default.width*SCG.gameControls.scale.times;SCG.viewfield.height=SCG.viewfield.default.height*SCG.gameControls.scale.times;n=0;t=0;SCG.viewfield.width<i?t=Math.round((i-SCG.viewfield.width)/2):SCG.viewfield.height<r&&(n=Math.round((r-SCG.viewfield.height)/2));this.setCanvasProperties(SCG.canvas,n,t);this.setCanvasProperties(SCG.canvasBg,n,t);this.setCanvasProperties(SCG.canvasUI,n,t);SCG.scenes.activeScene.backgroundRender!=undefined&&isFunction(SCG.scenes.activeScene.backgroundRender)&&SCG.scenes.activeScene.backgroundRender();SCG.UI.invalidate()},setCanvasProperties:function(n,t,i){setAttributes(n,{width:SCG.viewfield.width,height:SCG.viewfield.height,css:{width:SCG.viewfield.width+"px",height:SCG.viewfield.height+"px","margin-top":t+"px","margin-left":i+"px"}});n.width=SCG.viewfield.width;n.height=SCG.viewfield.height;n.margins={top:t,left:i}},permanentEventInit:function(){var n=this;document.addEventListener("keydown",function(t){n.permanentKeyDown(t)},!1);document.addEventListener("keyup",function(t){n.permanentKeyUp(t)},!1);addListenerMulti(SCG.canvasUI,"mousedown touchstar",function(t){absorbTouchEvent(t);t.type=="touchstart"&&n.mouseMove(t);n.mouseDown(t)});addListenerMulti(SCG.canvasUI,"mouseup touchend",function(t){absorbTouchEvent(t);n.mouseUp(t)});addListenerMulti(SCG.canvasUI,"mouseout touchleave",function(t){absorbTouchEvent(t);n.mouseOut(t)});addListenerMulti(SCG.canvasUI,"mousemove touchmove",function(t){absorbTouchEvent(t);n.mouseMove(t)});SCG.canvasUI.addEventListener("contextmenu",function(n){return n.preventDefault(),!1},!1)},permanentKeyDown:function(n){this.keyboardstate.shiftPressed=n.shiftKey;this.keyboardstate.ctrlPressed=n.ctrlKey;this.keyboardstate.altPressed=n.altKey},permanentKeyUp:function(n){this.keyboardstate.shiftPressed=n.shiftKey;this.keyboardstate.ctrlPressed=n.ctrlKey;this.keyboardstate.altPressed=n.altKey;switch(n.which){case 32:n.shiftKey?SCG.gameLogics.isPausedStep=!0:SCG.gameLogics.isPaused=!SCG.gameLogics.isPaused;break;case 69:SCG.GO.EnemyPaths.show=!SCG.GO.EnemyPaths.show;break;case 80:SCG.Placeable.show=!SCG.Placeable.show}}};SCG.debugger={el:getDOMByClassName(".debugger"),initialized:!1,init:function(){this.el=getDOMByClassName(".debugger");this.el==undefined&&(this.el=appendDomElement(document.body,"div",{"class":"debugger"}));this.initialized=!0},clear:function(){this.setValue("")},setValue:function(n){this.initialized||this.init();this.el.innerHTML=n}};SCG.GO={};SCG.GO.GO=function(n){if(this.defaultInitProperties={},this.position=new Vector2,this.renderPosition=new Vector2,this.renderBox=undefined,this.alive=!0,this.type="unidentifiedType",this.id="",this.size=new Vector2,this.renderSize=new Vector2,this.initialDirection=new Vector2,this.direction=new Vector2,this.speed=0,this.angle=0,this.renderRadius=10,this.img=undefined,this.imgPropertyName=undefined,this.selected=!1,this.playerControllable=!1,this.destination=undefined,this.path=[],this.mouseOver=!1,this.randomizeDestination=!1,this.randomizeDestinationRadius=new Vector2,this.setDeadOnDestinationComplete=!1,this.health=1,this.maxHealth=1,this.isDrawingHealthBar=!1,this.isCustomRender=!1,this.handlers={},this.isAnimated=!1,this.animation={totalFrameCount:0,framesInRow:0,framesRowsCount:0,frameChangeDelay:0,destinationFrameSize:new Vector2,sourceFrameSize:new Vector2,currentDestination:new Vector2,currentFrame:0,reverse:!1,paused:!1,loop:!1,animationTimer:undefined,animationEndCallback:function(){},frameChange:function(){if(!this.animation.paused){if(this.animation.reverse?this.animation.currentFrame--:this.animation.currentFrame++,!this.animation.reverse&&this.animation.currentFrame>this.animation.totalFrameCount||this.animation.reverse&&this.animation.currentFrame<1)if(this.animation.loop)this.animation.currentFrame=this.animation.reverse?this.animation.totalFrameCount:1;else{this.animation.animationEndCallback.call(this);return}var n=Math.ceil(this.animation.currentFrame/this.animation.framesInRow),t=this.animation.framesInRow-(n*this.animation.framesInRow-this.animation.currentFrame);this.animation.currentDestination=new Vector2(t-1,n-1)}}},n==undefined)throw"SCG.GO.GO -> props are undefined";if(n.size==undefined||n.size.equal(new Vector2))throw"SCG.GO.GO -> size is undefined";if(n!=undefined&&extend(!0,this,n),this.direction!=undefined&&(this.initialDirection=this.direction),this.isAnimated&&(this.size=this.animation.destinationFrameSize.clone(),this.animation.currentFrame=0,this.animation.animationTimer={lastTimeWork:new Date,delta:0,currentDelay:this.animation.frameChangeDelay,originDelay:this.animation.frameChangeDelay,doWorkInternal:this.animation.frameChange,context:this}),SCG.GO.GO.counter[this.type]==undefined&&(SCG.GO.GO.counter[this.type]=0),this.id=this.type+ ++SCG.GO.GO.counter[this.type],this.health=this.maxHealth,this.creationTime=new Date,this.handlers.click&&isFunction(this.handlers.click)){var t=SCG.gameControls.mousestate.eventHandlers;t.click.indexOf(this)==-1&&t.click.push(this)}this.initializer!=undefined&&isFunction(this.initializer)&&this.initializer(this);this.img==undefined&&this.imgPropertyName!=undefined&&(this.img=SCG.images[this.imgPropertyName]);SCG.AI.worker&&SCG.AI.sendEvent({type:"created",message:{goType:this.type,id:this.id,position:this.position.clone()}})};SCG.GO.GO.counter={};SCG.GO.GO.prototype={constructor:SCG.GO.GO,beforeDead:function(){},setDead:function(){this.beforeDead();var n=SCG.gameControls.mousestate.eventHandlers,t=n.click.indexOf(this);t>-1&&n.click.splice(t,1);SCG.AI.worker&&SCG.AI.sendEvent({type:"removed",message:{goType:this.type,id:this.id}});this.alive=!1},isAlive:function(){return this.alive},render:function(){if(!this.alive||!this.renderPosition)return!1;if(this.internalPreRender(),this.isCustomRender)this.customRender();else{if(this.img==undefined&&this.imgPropertyName!=undefined&&(this.img=SCG.images[this.imgPropertyName],this.img==undefined))throw"Cant achieve image named: "+this.imgPropertyName;this.img!=undefined&&(this.isAnimated?SCG.context.drawImage(this.img,this.animation.currentDestination.x*this.animation.sourceFrameSize.x,this.animation.currentDestination.y*this.animation.sourceFrameSize.y,this.animation.sourceFrameSize.x,this.animation.sourceFrameSize.y,this.renderPosition.x-this.renderSize.x/2,this.renderPosition.y-this.renderSize.y/2,this.renderSize.x,this.renderSize.y):SCG.context.drawImage(this.img,this.renderPosition.x-this.renderSize.x/2,this.renderPosition.y-this.renderSize.y/2,this.renderSize.x,this.renderSize.y))}this.internalRender()},customRender:function(){},internalPreRender:function(){},internalRender:function(){},update:function(n){return!this.alive||SCG.gameLogics.isPaused||SCG.gameLogics.gameOver||SCG.gameLogics.wrongDeviceOrientation?!1:(this.mouseOver=!1,this.internalPreUpdate(n),!this.alive)?!1:(this.destination&&(this.position.distance(this.destination)<=this.speed?this.setDestination():this.position.add(this.direction.mul(this.speed),!0)),this.destination==undefined&&(this.path.length>0&&this.setDestination(this.path.shift()),this.setDeadOnDestinationComplete))?(this.setDead(),!1):(this.renderSize=this.size.mul(SCG.gameControls.scale.times),this.box=new Box(new Vector2(this.position.x-this.size.x/2,this.position.y-this.size.y/2),this.size),this.renderPosition=undefined,SCG.viewfield.current.isIntersectsWithBox(this.box)&&(this.renderPosition=new Vector2(this.position.x*SCG.gameControls.scale.times,this.position.y*SCG.gameControls.scale.times).add(SCG.viewfield.current.topLeft.mul(-1)),this.renderBox=new Box(new Vector2(this.renderPosition.x-this.renderSize.x/2,this.renderPosition.y-this.renderSize.y/2),this.renderSize)),this.isAnimated&&doWorkByTimer(this.animation.animationTimer,n),this.internalUpdate(n),this.alive?void 0:!1)},internalPreUpdate:function(){},internalUpdate:function(){},setDestination:function(n){n!==undefined&&n instanceof Vector2?(this.randomizeDestination&&n.add(new Vector2(getRandom(-this.randomizeDestinationRadius,this.randomizeDestinationRadius),getRandom(-this.randomizeDestinationRadius,this.randomizeDestinationRadius)),!0),this.destination=n,this.direction=this.position.direction(this.destination)):(this.destination=undefined,this.direction=new Vector2)},renderSelectBox:function(){this.selectBoxColor===undefined&&(this.selectBoxColor={max:255,min:100,current:255,direction:1,step:1,colorPattern:"rgb({0},0,0)"},this.playerControllable&&(this.selectBoxColor.colorPattern="rgb(0,{0},0)"));this.renderBox.render({fill:!1,strokeStyle:String.format(this.selectBoxColor.colorPattern,this.selectBoxColor.current),lineWidth:2});(this.selectBoxColor.current>=this.selectBoxColor.max||this.selectBoxColor.current<=this.selectBoxColor.min)&&(this.selectBoxColor.direction*=-1);this.selectBoxColor.current+=this.selectBoxColor.step*this.selectBoxColor.direction},clickHandler:function(){}};SCG.GO.goBaseProperties={};SCG.GO.create=function(n,t){if(n==undefined)throw"SCG.GO.create -> name is empty";t==undefined&&(t={});var i=SCG.GO.goBaseProperties[n];if(i==undefined)throw"SCG.GO.create -> can't find base properties ba provided name "+n;return new SCG.GO.GO(extend({},i,t))};SCG.GO.register=function(n,t){if(n==undefined)throw"SCG.GO.register -> name is empty";if(t==undefined)throw"SCG.GO.register -> baseProperties is undefined";SCG.GO.goBaseProperties[n]=t};SCG.frameCounter={lastTimeCheck:new Date,checkDelta:1e3,prevRate:0,current:0,renderConsumption:{begin:new Date,end:new Date},visibleCount:0,draw:function(){SCG.context.save();SCG.context.fillStyle="red";SCG.context.font="48px serif";SCG.context.fillText(this.prevRate,SCG.viewfield.width-60,40);SCG.context.font="24px serif";SCG.context.fillText(this.visibleCount,SCG.viewfield.width-60,80);SCG.gameLogics.messageToShow!=""&&(SCG.context.fillStyle="black",SCG.context.font="24px serif",SCG.context.fillText(SCG.gameLogics.messageToShow,10,40));SCG.frameCounter.visibleCount=0;SCG.context.restore()},doWork:function(n){n-this.lastTimeCheck>this.checkDelta?(this.prevRate=this.current,this.current=0,this.lastTimeCheck=n):this.current++;this.draw()}};SCG.src={};SCG.images={};SCG.globals={addDefaultUIButtons:!0};SCG.customInitializaers=[];window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,1e3/60)}}();SCG.initializer=function(n){var r=0,i=0;for(var t in SCG.src)i++;for(t in SCG.src)SCG.images[t]=new Image,SCG.images[t].onload=function(){++r>=i&&n()},SCG.images[t].src=SCG.src[t];i==0&&n()};SCG.customInitialization=function(){if(SCG.customInitializaers.length!=0)for(var n=0;n<SCG.customInitializaers.length;n++)isFunction(SCG.customInitializaers[n])&&SCG.customInitializaers[n]()};SCG.scenes={activeScene:undefined,scenes:{},selectScene:function(n){var t,u,i,r;if(this.scenes[n]==undefined)throw String.format("Scene {0} not found!",n);for(this.activeScene=this.scenes[n],SCG.gameControls.mousestate.eventHandlers.click=[],t=0,u=this.activeScene.go.length;t<u;t++)i=this.activeScene.go[t],i.handlers.click&&(r=SCG.gameControls.mousestate.eventHandlers,r.click.indexOf(i)==-1&&r.click.push(i));SCG.contextBg&&(SCG.contextBg.clearRect(0,0,SCG.viewfield.width,SCG.viewfield.height),this.activeScene.backgroundRender!=undefined&&isFunction(this.activeScene.backgroundRender)&&this.activeScene.backgroundRender());SCG.AI.initialize();this.activeScene.ui=[];SCG.globals.addDefaultUIButtons&&SCG.UI.addDefaultUIButtons();SCG.contextUI&&SCG.UI.invalidate();this.activeScene.start!=undefined&&isFunction(this.activeScene.start)&&this.activeScene.start()},registerScene:function(n){var t,i,r;if(n.name===undefined)throw"Can't register scene without name";if(t=n.gameObjectsBaseProperties,t!=undefined&&isArray(t))for(i=0;i<t.length;i++){if(r=t[i].type,SCG.GO.goBaseProperties[r]!=undefined)throw String.format("SCG.scenes.registerScene -> BaseProperty with type '{0} already registered'",r);SCG.GO.register(r,t[i])}this.scenes[n.name]={start:n.start!==undefined&&isFunction(n.start)?n.start:undefined,preMainWork:n.preMainWork!==undefined&&isFunction(n.preMainWork)?n.preMainWork.bind(this):undefined,afterMainWork:n.afterMainWork!==undefined&&isFunction(n.afterMainWork)?n.afterMainWork.bind(this):undefined,go:n.gameObjectGenerator!=undefined&&isFunction(n.gameObjectGenerator)?n.gameObjectGenerator():[],backgroundRender:n.backgroundRender!=undefined&&isFunction(n.backgroundRender)?n.backgroundRender:undefined,game:extend(!0,{},n.game),ui:[]}}};SCG.AI.initialize=function(){SCG.AI.worker&&(SCG.AI.worker.terminate(),SCG.AI.worker=undefined,URL.revokeObjectURL(SCG.AI.blobURL));SCG.scenes.activeScene.game&&SCG.scenes.activeScene.game.AI&&(SCG.AI.blobURL=URL.createObjectURL(new Blob(["(","function(){var queue = [];\nconsole.log('worker start');\n"+(SCG.scenes.activeScene.game.AI.queueProcesser!=undefined&&isFunction(SCG.scenes.activeScene.game.AI.queueProcesser)?SCG.scenes.activeScene.game.AI.queueProcesser.toString():"function queueProcesser(){}")+"\nfunction processMessageQueue(){\nif(queue.length > 0){\nqueueProcesser();\n}\nsetTimeout(processMessageQueue, 100);\n}\nself.onmessage = function(e){\nvar msg = e.data;\nswitch(msg.command){\ncase 'event':\nqueue.push(msg.event);\nbreak;\ncase 'initialize':\nself.environment=msg.environment;\nqueue.push({type: 'start', message: undefined})\nbreak;\ndefault:\nbreak;\n}\n}\nprocessMessageQueue();\n}",")()"],{type:"application/javascript"})),SCG.AI.worker=new Worker(SCG.AI.blobURL));SCG.AI.worker&&SCG.scenes.activeScene.game.AI.messagesProcesser!=undefined&&isFunction(SCG.scenes.activeScene.game.AI.messagesProcesser)&&(SCG.AI.worker.onmessage=function(n){SCG.scenes.activeScene.game.AI.messagesProcesser(n.data)})};SCG.AI.initializeEnvironment=function(n){SCG.AI.worker.postMessage({command:"initialize",environment:n})};SCG.AI.sendEvent=function(n){SCG.AI.worker.postMessage({command:"event",event:n})};SCG.UI={initialized:!1,invalidate:function(){SCG.contextUI.clearRect(0,0,SCG.viewfield.width,SCG.viewfield.height);for(var n=SCG.scenes.activeScene,t=n.ui.length;t--;)n.ui[t].update(),n.ui[t].render()},addDefaultUIButtons:function(){var n=SCG.GO.create("button",{position:new Vector2(SCG.viewfield.width-25,SCG.viewfield.height-25),handlers:{click:function(){return screenfull.toggle(document.documentElement),{preventBubbling:!0}}}});SCG.scenes.activeScene.ui.push(n)},initialize:function(){if(!this.initialized)for(var n=0;n<this.controls.length;n++)SCG.GO.register(this.controls[n].type,this.controls[n])}};SCG.UI.controls=[{type:"button",size:new Vector2(50,50),isCustomRender:!0,innerCanvas:undefined,initializer:function(n){n.innerCanvas=document.createElement("canvas");n.innerCanvas.width=n.size.x;n.innerCanvas.height=n.size.y;n.innerCanvasContext=n.innerCanvas.getContext("2d");var t=n.innerCanvasContext;t.beginPath();t.rect(0,0,n.size.x,n.size.y);t.fillStyle="red";t.fill()},customRender:function(){SCG.contextUI.drawImage(this.innerCanvas,this.renderPosition.x-this.renderSize.x/2,this.renderPosition.y-this.renderSize.y/2,this.renderSize.x,this.renderSize.y)}}];SCG.UI.initialize();SCG.start=function(){SCG.canvasBg||(SCG.canvasBg=appendDomElement(document.body,"canvas",{width:SCG.viewfield.width,height:SCG.viewfield.height,id:SCG.canvasBgId,css:{"z-index":0,position:"absolute"}}),SCG.contextBg=SCG.canvasBg.getContext("2d"));SCG.canvas||(SCG.canvas=appendDomElement(document.body,"canvas",{width:SCG.viewfield.width,height:SCG.viewfield.height,id:SCG.canvasId,css:{"z-index":1,position:"absolute"}}),SCG.context=SCG.canvas.getContext("2d"));SCG.canvasUI||(SCG.canvasUI=appendDomElement(document.body,"canvas",{width:SCG.viewfield.width,height:SCG.viewfield.height,id:SCG.canvasUIId,css:{"z-index":2,position:"absolute"}}),SCG.contextUI=SCG.canvasUI.getContext("2d"));SCG.initializer(function(){SCG.space==undefined&&(SCG.space={width:SCG.viewfield.default.width,height:SCG.viewfield.default.height});SCG.viewfield.current=new Box(new Vector2,new Vector2(SCG.viewfield.width,SCG.viewfield.height));SCG.gameControls.orientationChangeEventInit();SCG.customInitialization();SCG.UI.invalidate();SCG.animate()})};SCG.preMainWork=function(){};SCG.afterMainWork=function(){};SCG.animate=function(){SCG.draw();requestAnimationFrame(SCG.animate)};SCG.draw=function(){var i,n,t,r;if(SCG.scenes.activeScene==undefined||SCG.scenes.activeScene.go==undefined)throw"Active scene corrupted!";for(i=new Date,SCG.gameLogics.doPauseWork(i),n=SCG.scenes.activeScene,n.preMainWork&&isFunction(n.preMainWork)&&n.preMainWork(),t=n.go.length;t--;)n.go[t].update(i),n.go[t].render(),n.go[t].alive||(r=n.go.splice(t,1));n.afterMainWork&&isFunction(n.afterMainWork)&&n.afterMainWork();SCG.gameLogics.isPausedStep&&(SCG.gameLogics.isPausedStep=!1);SCG.frameCounter.doWork(i)};
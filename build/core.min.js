function Box(n,t){this.topLeft=n;this.size=t;this.center=new Vector2(this.topLeft.x+t.x/2,this.topLeft.y+t.y/2);this.bottomRight=new Vector2(this.topLeft.x+this.size.x,this.topLeft.y+this.size.y);this.topRight=new Vector2(this.bottomRight.x,this.topLeft.y);this.bottomLeft=new Vector2(this.topLeft.x,this.bottomRight.y);this.update=function(n,t){this.topLeft=n;t!==undefined&&(this.size=t);this.center=new Vector2(this.topLeft.x+this.size.x/2,this.topLeft.y+this.size.y/2);this.bottomRight=new Vector2(this.topLeft.x+this.size.x,this.topLeft.y+this.size.y)};this.isPointInside=function(n){return n instanceof Vector2&&this.topLeft.x<=n.x&&n.x<=this.bottomRight.x&&this.topLeft.y<=n.y&&n.y<=this.bottomRight.y};this.isIntersectsWithCircle=function(n){return boxCircleIntersects(n,this)};this.isIntersectsWithBox=function(n){return boxIntersectsBox(this,n)};this.render=function(n){var t={fillStyle:"rgba(0, 255, 0, 0.5)",lineWidth:1,strokeStyle:"#00FF00"};isBoolean(n)?t.fill=n:extend(t,n);SCG.context.beginPath();SCG.context.rect(this.topLeft.x,this.topLeft.y,this.size.x,this.size.y);t.fill&&(SCG.context.fillStyle=t.fillStyle,SCG.context.fill());SCG.context.lineWidth=t.lineWidth;SCG.context.strokeStyle=t.strokeStyle;SCG.context.closePath();SCG.context.stroke()}}function getRandom(n,t){return Math.random()*(t-n)+n}function getRandomInt(n,t){return Math.round(getRandom(n,t))}function boxIntersectsBox(n,t){return Math.abs(n.center.x-t.center.x)*2<n.size.x+t.size.x&&Math.abs(n.center.y-t.center.y)*2<n.size.y+t.size.y}function radiansToDegree(n){return n===undefined?0:n*180/Math.PI}function degreeToRadians(n){return n===undefined?0:n*Math.PI/180}function isBoolean(n){return n.constructor===Boolean||typeof n=="boolean"}function isString(){return typeof myVar=="string"||myVar instanceof String}function isArray(n){return Object.prototype.toString.call(n)==="[object Array]"}function isFunction(n){return typeof n=="function"}function absorbTouchEvent(n){if(n.type=="touchstart"||n.type=="touchmove"||n.type=="touchend"||n.type=="touchcancel"){var t=n||window.event;return t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0,t.returnValue=!1,!1}}function checkClamps(n,t){return!isArray(n)||isEmpty(n)?1:(t>n[1]?t=n[1]:t<n[0]&&(t=n[0]),t==n[0]||t==n[1])?-1:1}function isBetween(n,t,i){if(t>i){var r=i;i=t;t=r}return n>=t&&n<=i}function isEmpty(n){if(n==null)return!0;if(n.length>0)return!1;if(n.length===0)return!0;for(var t in n)if(hasOwnProperty.call(n,t))return!1;return!0}function sqr(n){return n*n}function dist2(n,t){return sqr(n.x-t.x)+sqr(n.y-t.y)}function distToSegmentSquared(n,t,i){var u=dist2(t,i),r;return u==0?dist2(n,t):(r=((n.x-t.x)*(i.x-t.x)+(n.y-t.y)*(i.y-t.y))/u,r<0)?dist2(n,t):r>1?dist2(n,i):dist2(n,{x:t.x+r*(i.x-t.x),y:t.y+r*(i.y-t.y)})}function distToSegment(n,t,i){return Math.sqrt(distToSegmentSquared(n,t,i))}function getDegreeToVectorUp(n,t){var i=Vector2.up(),r=t.substract(n,!0);return Math.acos(r.mulVector(i)/(r.module()*i.module()))}function doWorkByTimer(n,t){if(SCG.gameLogics.isPaused){n.delta=0;return}n.delta=t-n.lastTimeWork;SCG.gameLogics.pauseDelta!=0&&(n.delta-=SCG.gameLogics.pauseDelta);n.currentDelay-=n.delta;n.currentDelay<=0&&(n.currentDelay=n.originDelay,n.doWorkInternal.call(n.context));n.lastTimeWork=t}function extend(){var f,u,i,t,e,o,n=arguments[0]||{},r=1,h=arguments.length,s=!1;for(typeof n=="boolean"&&(s=n,n=arguments[r]||{},r++),typeof n=="object"||isFunction(n)||(n={}),r===h&&(n=this,r--);r<h;r++)if((f=arguments[r])!=null)for(u in f)(i=n[u],t=f[u],n!==t)&&(s&&t&&(isPlainObject(t)||(e=isArray(t)))?(e?(e=!1,o=i&&isArray(i)?i:[]):o=i&&isPlainObject(i)?i:{},n[u]=extend(s,o,t)):t!==undefined&&(n[u]=t));return n}function isPlainObject(n){var t,i,f=Object.prototype.toString,r=Object.prototype.hasOwnProperty,u=r.toString,e=u.call(Object);return!n||f.call(n)!=="[object Object]"?!1:(t=getProto(n),!t)?!0:(i=r.call(t,"constructor")&&t.constructor,typeof i=="function"&&u.call(i)===e)}function getDOMByClassName(n){var t=undefined,i=document.getElementsByClassName(n);return i.length>0&&(t=i[0]),t}function appendDomElement(n,t,i){if(!(n instanceof HTMLElement)&&!(n instanceof HTMLDocument)&&!(n instanceof HTMLBodyElement))throw"Cant append new element to non html Node";if(t!=undefined&&typeof t!="string")throw"Type must be a string";var r=document.createElement(t);return setAttributes(r,i),n.appendChild(r),r}function setAttributes(n,t){var i,r,u,f,e;for(i in t)if(t.hasOwnProperty(i))if(i=="on"){r=t[i];for(u in r)r.hasOwnProperty(u)&&n.addEventListener(u,r[u],!1)}else if(i=="css"){f=t[i];for(e in f)f.hasOwnProperty(e)&&(n.style[e]=f[e])}else n.setAttribute(i,t[i])}function addListenerMulti(n,t,i){t.split(" ").forEach(function(t){n.addEventListener(t,i,!1)})}function drawFigures(n,t,i){var f,r,u;for(i==undefined&&(i=1),n.globalAlpha=i,f=0;f<t.length;f++)if(r=t[f],!(r.length<3)){for(n.beginPath(),n.moveTo(r[0].x,r[0].y),u=1;u<r.length;u++)n.lineTo(r[u].x,r[u].y);n.fill()}}function Vector2(n,t){n==undefined&&(n=0);t==undefined&&(t=0);this.x=n;this.y=t}var pointerEventToXY,getProto,SCG;(function(){"use strict";var i=typeof module!="undefined"&&module.exports,r=typeof Element!="undefined"&&"ALLOW_KEYBOARD_INPUT"in Element,n=function(){for(var t,r,i=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],n=0,f=i.length,u={};n<f;n++)if(t=i[n],t&&t[1]in document){for(n=0,r=t.length;n<r;n++)u[i[0][n]]=t[n];return u}return!1}(),t={request:function(t){var i=n.requestFullscreen;t=t||document.documentElement;/5\.1[\.\d]* Safari/.test(navigator.userAgent)?t[i]():t[i](r&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){document[n.exitFullscreen]()},toggle:function(n){this.isFullscreen?this.exit():this.request(n)},raw:n};if(!n){i?module.exports=!1:window.screenfull=!1;return}Object.defineProperties(t,{isFullscreen:{get:function(){return!!document[n.fullscreenElement]}},element:{enumerable:!0,get:function(){return document[n.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return!!document[n.fullscreenEnabled]}}});i?module.exports=t:window.screenfull=t})();String.format||(String.format=function(n){var t=Array.prototype.slice.call(arguments,1);return n.replace(/{(\d+)}/g,function(n,i){return typeof t[i]!="undefined"?t[i]:n})});pointerEventToXY=function(n){var t={x:0,y:0},i;return n.type=="touchstart"||n.type=="touchmove"||n.type=="touchend"||n.type=="touchcancel"?(i=n.touches[0]||n.changedTouches[0],t.x=i.pageX,t.y=i.pageY):(n.type=="mousedown"||n.type=="mouseup"||n.type=="mousemove"||n.type=="mouseover"||n.type=="mouseout"||n.type=="mouseenter"||n.type=="mouseleave"||n.type=="click")&&(t.x=n.pageX,t.y=n.pageY),t};getProto=Object.getPrototypeOf||function(n){return n.__proto__};Vector2.prototype={distance:function(n){return!n||!(n instanceof Vector2)?undefined:new Vector2(n.x-this.x,n.y-this.y).module()},directionNonNormal:function(n){return!n||!(n instanceof Vector2)?new Vector2:new Vector2(n.x-this.x,n.y-this.y)},direction:function(n){return!n||!(n instanceof Vector2)?new Vector2:new Vector2(n.x-this.x,n.y-this.y).normalize()},normalize:function(){var n=this.module();return this.x/=n,this.y/=n,this},module:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},add:function(n,t){return t===undefined&&(t=!1),n instanceof Vector2?t?(this.x+=n.x,this.y+=n.y,this):new Vector2(this.x+n.x,this.y+n.y):void 0},substract:function(n,t){return(t===undefined&&(t=!1),n instanceof Vector2)?t?(this.x-=n.x,this.y-=n.y,this):new Vector2(this.x-n.x,this.y-n.y):new Vector2},mul:function(n){return new Vector2(this.x*n,this.y*n)},division:function(n){return new Vector2(this.x/n,this.y/n)},dot:function(n){return this.mulVector(n)},cross:function(n){return!n||!(n instanceof Vector2)?0:this.x*n.y-this.y*n.x},mulVector:function(n){return!n||!(n instanceof Vector2)?0:this.x*n.x+this.y*n.y},rotate:function(n,t,i){t===undefined&&(t=!1);i===undefined&&(i=!1);var r=new Vector2(this.x*Math.cos(t?n:n*Math.PI/180)-this.y*Math.sin(t?n:n*Math.PI/180),this.x*Math.sin(t?n:n*Math.PI/180)+this.y*Math.cos(t?n:n*Math.PI/180));return i?(this.x=r.x,this.y=r.y,this):r},clone:function(){return new Vector2(this.x,this.y)},equal:function(n){return!n||!(n instanceof Vector2)?!1:this.x==n.x&&this.y==n.y},toString:function(){return"x: "+this.x+", y: "+this.y},angleTo:function(n,t){if(!n||!(n instanceof Vector2))throw"Param is not a vetor2 instance";t==undefined&&(t=!1);var i=Math.atan2(this.cross(n),this.dot(n));return t?i:i*180/Math.PI}};Vector2.average=function(n){var i,t;if(!isArray(n)||isEmpty(n))throw"Param is not defined";for(i=new Vector2,t=0;t<n.length;t++)i.add(n[t],!0);return i.division(n.length)};Vector2.left=function(){return new Vector2(-1,0)};Vector2.right=function(){return new Vector2(1,0)};Vector2.up=function(){return new Vector2(0,-1)};Vector2.down=function(){return new Vector2(0,1)};SCG={test:"test"};SCG.AI={};SCG.space=undefined;SCG.viewfield={"default":{width:500,height:300},width:500,height:300,current:undefined};SCG.canvas=undefined;SCG.canvasId="mainCanvas";SCG.canvasBg=undefined;SCG.canvasBgId="backgroundCanvas";SCG.canvasUI=undefined;SCG.canvasUIId="uiCanvas";SCG.context=undefined;SCG.contextBg=undefined;SCG.contextUI=undefined;SCG.gameLogics={isPaused:!1,isPausedStep:!1,gameOver:!1,drawBoundings:!0,fillBoundings:!1,wrongDeviceOrientation:!1,messageToShow:"",isMobile:!1,pausedFrom:undefined,pauseDelta:0,doPauseWork:function(n){this.isPaused&&this.pausedFrom==undefined?(this.pausedFrom=n,this.pauseDelta=0):this.pausedFrom==undefined||this.isPaused?this.pauseDelta!=0&&(this.pauseDelta=0):(this.pauseDelta=n-this.pausedFrom,this.pausedFrom=undefined)},pauseToggle:function(){SCG.gameLogics.isPaused=!SCG.gameLogics.isPaused;SCG.UI.invalidate();SCG.audio&&SCG.audio.playPause()}};SCG.go=[];SCG.gameControls={scale:{times:1},selectedGOs:[],camera:{mode:"free",shiftSpeed:5,centeredOn:undefined,resetAfterUpdate:!1,preventModeSwitch:!0,shifts:{left:!1,right:!1,up:!1,down:!1},free:function(){this.preventModeSwitch||(SCG.gameControls.camera.mode="free",this.centeredOn=undefined)},center:function(){if(!this.preventModeSwitch){var n=SCG.gameControls;n.selectedGOs.length==1?(n.camera.mode="centered",this.centeredOn=n.selectedGOs[0]):(n.camera.mode="free",this.centeredOn=undefined)}},reset:function(){var n=this.shifts;n.left=!1;n.right=!1;n.up=!1;n.down=!1},update:function(){var i=this.shifts,n=undefined,t,r;this.mode==="free"?(t=undefined,i.left&&(t=Vector2.left()),i.right&&(t=Vector2.right()),i.up&&(t!=undefined?t.add(Vector2.up()):t=Vector2.up()),i.down&&(t!=undefined?t.add(Vector2.down()):t=Vector2.down()),t!==undefined&&(r=t.mul(this.shiftSpeed),n=SCG.viewfield.current.topLeft.add(r))):this.mode==="centered"&&this.centeredOn!==undefined&&(n=this.centeredOn.position.substract(new Vector2(SCG.viewfield.default.width/2,SCG.viewfield.default.height/2)));this.resetAfterUpdate&&this.reset();n!=undefined&&(n.x<0&&(n.x=0),n.y<0&&(n.y=0),n.x+SCG.viewfield.current.width>SCG.space.width&&(n.x=SCG.space.width-SCG.viewfield.current.width),n.y+SCG.viewfield.current.height>SCG.space.height&&(n.y=SCG.space.height-SCG.viewfield.current.height),SCG.viewfield.current.update(n))}},mousestate:{position:new Vector2,delta:new Vector2,leftButtonDown:!1,rightButtonDown:!1,middleButtonDown:!1,timer:undefined,reset:function(){this.leftButtonDown=!1;this.rightButtonDown=!1;this.middleButtonDown=!1},stopped:function(){SCG.gameControls.mousestate.delta=new Vector2},toString:function(){return"position: "+this.position.toString()+"<br/>leftButtonDown: "+this.leftButtonDown},doClickCheck:function(){for(var n,u,t,i=SCG.gameControls,r=0;r<this.eventHandlers.click.length;r++)if(n=this.eventHandlers.click[r],n.renderBox!=undefined&&n.renderBox.isPointInside(i.mousestate.position)&&n.handlers!=undefined&&n.handlers.click!=undefined&&isFunction(n.handlers.click)){if(u=n.handlers.click.call(n),u&&u.preventBubbling)return;break}t=SCG.scenes.activeScene.game;t.clickHandler!=undefined&&isFunction(t.clickHandler)&&t.clickHandler(i.mousestate.position.division(i.scale.times))},eventHandlers:{click:[]}},keyboardstate:{altPressed:!1,shiftPressed:!1,ctrlPressed:!1},mouseDown:function(n){var t=SCG.gameControls.mousestate;if(n.type=="touchstart")n.originalEvent.changedTouches!=undefined&&n.originalEvent.changedTouches.length==1&&(t.leftButtonDown=!0);else switch(n.which){case 1:t.leftButtonDown=!0;break;case 2:t.middleButtonDown=!0;break;case 3:t.rightButtonDown=!0;break;default:t.reset()}},mouseOut:function(){SCG.gameControls.mousestate.reset()},mouseUp:function(n){var i=this,t=SCG.gameControls.mousestate;if(i.getEventAbsolutePosition(n),n.type=="touchstart")n.originalEvent.changedTouches!=undefined&&n.originalEvent.changedTouches.length==1&&(t.leftButtonDown=!1);else switch(n.which){case 1:t.leftButtonDown=!1;break;case 2:t.middleButtonDown=!1;break;case 3:t.rightButtonDown=!1;break;default:t.reset()}i.mousestate.doClickCheck();n.preventDefault()},mouseMove:function(n){var i=this,t=SCG.gameControls.mousestate,r=t.position.clone();i.getEventAbsolutePosition(n);t.delta=t.position.substract(r);SCG.debugger.setValue(t.toString())},getEventAbsolutePosition:function(n){var t=pointerEventToXY(n);SCG.gameControls.mousestate.position=new Vector2(t.x-SCG.canvasUI.margins.left,t.y-SCG.canvasUI.margins.top)},orientationChangeEventInit:function(){var n=this;SCG.gameControls.permanentEventInit();addListenerMulti(window,"orientationchange resize",function(){n.graphInit()});SCG.gameLogics.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);SCG.gameLogics.isMobile&&(setTimeout(function(){window.scrollTo(0,1)},100),addListenerMulti(document,"fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",function(){n.graphInit()}));this.graphInit()},graphInit:function(){var n=SCG.gameLogics,e,t,i,f;if(n.messageToShow="",n.wrongDeviceOrientation=!window.matchMedia("(orientation: landscape)").matches,n.wrongDeviceOrientation){n.messageToShow="wrong device orientation - portrait";return}if(e=window.innerWidth,e<SCG.viewfield.default.width){n.messageToShow=String.format("width lesser than {3} (width: {0}, iH: {1}, iW: {2})",e,window.innerHeight,window.innerWidth,SCG.viewfield.default.width);n.wrongDeviceOrientation=!0;return}var r=Math.max(document.documentElement.clientWidth,window.innerWidth||0),u=Math.max(document.documentElement.clientHeight,window.innerHeight||0),o=r/SCG.viewfield.default.width,s=u/SCG.viewfield.default.height;if(SCG.gameControls.scale.times=Math.min(o,s),SCG.gameControls.scale.times<1){n.messageToShow=String.format("window is to small (width: {0}, height: {1})",r,u);n.wrongDeviceOrientation=!0;return}SCG.viewfield.width=SCG.viewfield.default.width*SCG.gameControls.scale.times;SCG.viewfield.height=SCG.viewfield.default.height*SCG.gameControls.scale.times;t=0;i=0;SCG.viewfield.width<r?i=Math.round((r-SCG.viewfield.width)/2):SCG.viewfield.height<u&&(t=Math.round((u-SCG.viewfield.height)/2));this.setCanvasProperties(SCG.canvas,t,i);this.setCanvasProperties(SCG.canvasBg,t,i);this.setCanvasProperties(SCG.canvasUI,t,i);f=SCG.scenes.activeScene.backgroundRender;f!=undefined&&isFunction(f)&&f();SCG.UI.invalidate()},setCanvasProperties:function(n,t,i){setAttributes(n,{width:SCG.viewfield.width,height:SCG.viewfield.height,css:{width:SCG.viewfield.width+"px",height:SCG.viewfield.height+"px","margin-top":t+"px","margin-left":i+"px"}});n.width=SCG.viewfield.width;n.height=SCG.viewfield.height;n.margins={top:t,left:i}},permanentEventInit:function(){var n=this;document.addEventListener("keydown",function(t){n.permanentKeyDown(t)},!1);document.addEventListener("keyup",function(t){n.permanentKeyUp(t)},!1);addListenerMulti(SCG.canvasUI,"mousedown touchstar",function(t){absorbTouchEvent(t);t.type=="touchstart"&&n.mouseMove(t);n.mouseDown(t)});addListenerMulti(SCG.canvasUI,"mouseup touchend",function(t){absorbTouchEvent(t);n.mouseUp(t)});addListenerMulti(SCG.canvasUI,"mouseout touchleave",function(t){absorbTouchEvent(t);n.mouseOut(t)});addListenerMulti(SCG.canvasUI,"mousemove touchmove",function(t){absorbTouchEvent(t);n.mouseMove(t)});SCG.canvasUI.addEventListener("contextmenu",function(n){return n.preventDefault(),!1},!1)},permanentKeyDown:function(n){var t=this.keyboardstate;t.shiftPressed=n.shiftKey;t.ctrlPressed=n.ctrlKey;t.altPressed=n.altKey},permanentKeyUp:function(n){var t=this.keyboardstate;t.shiftPressed=n.shiftKey;t.ctrlPressed=n.ctrlKey;t.altPressed=n.altKey;switch(n.which){case 32:n.shiftKey?SCG.gameLogics.isPausedStep=!0:SCG.gameLogics.pauseToggle();break;case 69:SCG.GO.EnemyPaths.show=!SCG.GO.EnemyPaths.show;break;case 80:SCG.Placeable.show=!SCG.Placeable.show}}};SCG.debugger={el:getDOMByClassName(".debugger"),initialized:!1,init:function(){this.el=getDOMByClassName(".debugger");this.el==undefined&&(this.el=appendDomElement(document.body,"div",{"class":"debugger"}));this.initialized=!0},clear:function(){this.setValue("")},setValue:function(n){this.initialized||this.init();this.el.innerHTML=n}};SCG.GO={};SCG.GO.GO=function(n){if(this.defaultInitProperties={},this.position=new Vector2,this.renderPosition=new Vector2,this.renderBox=undefined,this.alive=!0,this.ui=!1,this.type="unidentifiedType",this.id="",this.size=new Vector2,this.renderSize=new Vector2,this.initialDirection=new Vector2,this.direction=new Vector2,this.speed=0,this.angle=0,this.renderRadius=10,this.img=undefined,this.imgPropertyName=undefined,this.selected=!1,this.playerControllable=!1,this.destination=undefined,this.path=[],this.mouseOver=!1,this.randomizeDestination=!1,this.randomizeDestinationRadius=new Vector2,this.setDeadOnDestinationComplete=!1,this.health=1,this.maxHealth=1,this.isDrawingHealthBar=!1,this.isCustomRender=!1,this.handlers={},this.isAnimated=!1,this.animation={totalFrameCount:0,framesInRow:0,framesRowsCount:0,frameChangeDelay:0,destinationFrameSize:new Vector2,sourceFrameSize:new Vector2,currentDestination:new Vector2,currentFrame:0,reverse:!1,paused:!1,loop:!1,animationTimer:undefined,animationEndCallback:function(){},frameChange:function(){var n=this.animation,t,i;if(!n.paused){if(n.reverse?n.currentFrame--:n.currentFrame++,!n.reverse&&n.currentFrame>n.totalFrameCount||n.reverse&&n.currentFrame<1)if(n.loop)n.currentFrame=n.reverse?n.totalFrameCount:1;else{n.animationEndCallback.call(this);return}t=Math.ceil(n.currentFrame/n.framesInRow);i=n.framesInRow-(t*n.framesInRow-n.currentFrame);n.currentDestination=new Vector2(i-1,t-1)}}},n==undefined)throw"SCG.GO.GO -> props are undefined";if(n.size==undefined||n.size.equal(new Vector2))throw"SCG.GO.GO -> size is undefined";if(n!=undefined&&extend(!0,this,n),this.direction!=undefined&&(this.initialDirection=this.direction),this.isAnimated&&(this.size=this.animation.destinationFrameSize.clone(),this.animation.currentFrame=0,this.animation.animationTimer={lastTimeWork:new Date,delta:0,currentDelay:this.animation.frameChangeDelay,originDelay:this.animation.frameChangeDelay,doWorkInternal:this.animation.frameChange,context:this}),SCG.GO.GO.counter[this.type]==undefined&&(SCG.GO.GO.counter[this.type]=0),this.id=this.type+ ++SCG.GO.GO.counter[this.type],this.health=this.maxHealth,this.creationTime=new Date,this.handlers.click&&isFunction(this.handlers.click)){var t=SCG.gameControls.mousestate.eventHandlers;t.click.indexOf(this)==-1&&t.click.push(this)}this.initializer!=undefined&&isFunction(this.initializer)&&this.initializer(this);this.img==undefined&&this.imgPropertyName!=undefined&&(this.img=SCG.images[this.imgPropertyName]);SCG.AI.worker&&SCG.AI.sendEvent({type:"created",message:{goType:this.type,id:this.id,position:this.position.clone()}})};SCG.GO.GO.counter={};SCG.GO.GO.prototype={constructor:SCG.GO.GO,beforeDead:function(){},setDead:function(){this.beforeDead();var n=SCG.gameControls.mousestate.eventHandlers,t=n.click.indexOf(this);t>-1&&n.click.splice(t,1);SCG.AI.worker&&SCG.AI.sendEvent({type:"removed",message:{goType:this.type,id:this.id}});this.alive=!1},isAlive:function(){return this.alive},render:function(){var i,n,t;if(!this.alive||!this.renderPosition)return!1;if(this.internalPreRender(),this.isCustomRender)this.customRender();else{if(this.img==undefined&&this.imgPropertyName!=undefined&&(this.img=SCG.images[this.imgPropertyName],this.img==undefined))throw"Cant achieve image named: "+this.imgPropertyName;this.img!=undefined&&(i=this.renderPosition,n=this.renderSize,this.isAnimated?(t=this.animation,SCG.context.drawImage(this.img,t.currentDestination.x*t.sourceFrameSize.x,t.currentDestination.y*t.sourceFrameSize.y,t.sourceFrameSize.x,t.sourceFrameSize.y,i.x-n.x/2,i.y-n.y/2,n.x,n.y)):SCG.context.drawImage(this.img,i.x-n.x/2,i.y-n.y/2,n.x,n.y))}this.internalRender()},customRender:function(){},internalPreRender:function(){},internalRender:function(){},update:function(n){return!this.ui&&(!this.alive||SCG.gameLogics.isPaused||SCG.gameLogics.gameOver||SCG.gameLogics.wrongDeviceOrientation)?!1:(this.mouseOver=!1,this.internalPreUpdate(n),!this.alive)?!1:(this.destination&&(this.position.distance(this.destination)<=this.speed?this.setDestination():this.position.add(this.direction.mul(this.speed),!0)),this.destination==undefined&&(this.path.length>0&&this.setDestination(this.path.shift()),this.setDeadOnDestinationComplete))?(this.setDead(),!1):(this.renderSize=this.size.mul(SCG.gameControls.scale.times),this.box=new Box(new Vector2(this.position.x-this.size.x/2,this.position.y-this.size.y/2),this.size),this.renderPosition=undefined,(SCG.viewfield.current.isIntersectsWithBox(this.box)||this.ui)&&(this.renderPosition=this.position.add(this.ui?new Vector2:SCG.viewfield.current.topLeft.mul(-1)).mul(SCG.gameControls.scale.times),this.renderBox=new Box(new Vector2(this.renderPosition.x-this.renderSize.x/2,this.renderPosition.y-this.renderSize.y/2),this.renderSize)),this.isAnimated&&doWorkByTimer(this.animation.animationTimer,n),this.internalUpdate(n),this.alive?void 0:!1)},internalPreUpdate:function(){},internalUpdate:function(){},setDestination:function(n){if(n!==undefined&&n instanceof Vector2){if(this.randomizeDestination){var t=this.randomizeDestinationRadius;n.add(new Vector2(getRandom(-t,t),getRandom(-t,t)),!0)}this.destination=n;this.direction=this.position.direction(this.destination)}else this.destination=undefined,this.direction=new Vector2},renderSelectBox:function(){var n=this.selectBoxColor;n===undefined&&(n={max:255,min:100,current:255,direction:1,step:1,colorPattern:"rgb({0},0,0)"},this.playerControllable&&(n.colorPattern="rgb(0,{0},0)"));this.renderBox.render({fill:!1,strokeStyle:String.format(n.colorPattern,n.current),lineWidth:2});(n.current>=n.max||n.current<=n.min)&&(n.direction*=-1);n.current+=n.step*n.direction},clickHandler:function(){}};SCG.GO.goBaseProperties={};SCG.GO.create=function(n,t){if(n==undefined)throw"SCG.GO.create -> name is empty";t==undefined&&(t={});var i=SCG.GO.goBaseProperties[n];if(i==undefined)throw"SCG.GO.create -> can't find base properties ba provided name "+n;return new SCG.GO.GO(extend({},i,t))};SCG.GO.register=function(n,t){if(n==undefined)throw"SCG.GO.register -> name is empty";if(t==undefined)throw"SCG.GO.register -> baseProperties is undefined";SCG.GO.goBaseProperties[n]=t};SCG.frameCounter={lastTimeCheck:new Date,checkDelta:1e3,prevRate:0,current:0,renderConsumption:{begin:new Date,end:new Date},visibleCount:0,draw:function(){var n=SCG.context;n.save();n.fillStyle="red";n.font="48px serif";n.fillText(this.prevRate,SCG.viewfield.width-60,40);n.font="24px serif";n.fillText(this.visibleCount,SCG.viewfield.width-60,80);SCG.gameLogics.messageToShow!=""&&(n.fillStyle="black",n.font="24px serif",n.fillText(SCG.gameLogics.messageToShow,10,40));SCG.frameCounter.visibleCount=0;n.restore()},doWork:function(n){n-this.lastTimeCheck>this.checkDelta?(this.prevRate=this.current,this.current=0,this.lastTimeCheck=n):this.current++;this.draw()}};SCG.src={};SCG.images={};SCG.globals={addDefaultUIButtons:!0};SCG.customInitializaers=[];window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,1e3/60)}}();SCG.initializer=function(n){var r=0,i=0;for(var t in SCG.src)i++;for(t in SCG.src)SCG.images[t]=new Image,SCG.images[t].onload=function(){++r>=i&&n()},SCG.images[t].src=SCG.src[t];i==0&&n()};SCG.customInitialization=function(){if(SCG.customInitializaers.length!=0)for(var n=0;n<SCG.customInitializaers.length;n++)isFunction(SCG.customInitializaers[n])&&SCG.customInitializaers[n]()};SCG.scenes={activeScene:undefined,scenes:{},selectScene:function(n){var t,u,i,r;if(this.scenes[n]==undefined)throw String.format("Scene {0} not found!",n);for(this.activeScene=this.scenes[n],SCG.gameControls.mousestate.eventHandlers.click=[],t=0,u=this.activeScene.go.length;t<u;t++)i=this.activeScene.go[t],i.handlers.click&&(r=SCG.gameControls.mousestate.eventHandlers,r.click.indexOf(i)==-1&&r.click.push(i));SCG.contextBg&&(SCG.contextBg.clearRect(0,0,SCG.viewfield.width,SCG.viewfield.height),this.activeScene.backgroundRender!=undefined&&isFunction(this.activeScene.backgroundRender)&&this.activeScene.backgroundRender());SCG.AI.initialize();this.activeScene.ui=[];SCG.globals.addDefaultUIButtons&&SCG.UI.addDefaultUIButtons();SCG.contextUI&&SCG.UI.invalidate();this.activeScene.start!=undefined&&isFunction(this.activeScene.start)&&this.activeScene.start()},registerScene:function(n){var t,i,r;if(n.name===undefined)throw"Can't register scene without name";if(t=n.gameObjectsBaseProperties,t!=undefined&&isArray(t))for(i=0;i<t.length;i++){if(r=t[i].type,SCG.GO.goBaseProperties[r]!=undefined)throw String.format("SCG.scenes.registerScene -> BaseProperty with type '{0} already registered'",r);SCG.GO.register(r,t[i])}this.scenes[n.name]={start:n.start!==undefined&&isFunction(n.start)?n.start:undefined,preMainWork:n.preMainWork!==undefined&&isFunction(n.preMainWork)?n.preMainWork.bind(this):undefined,afterMainWork:n.afterMainWork!==undefined&&isFunction(n.afterMainWork)?n.afterMainWork.bind(this):undefined,go:n.gameObjectGenerator!=undefined&&isFunction(n.gameObjectGenerator)?n.gameObjectGenerator():[],backgroundRender:n.backgroundRender!=undefined&&isFunction(n.backgroundRender)?n.backgroundRender:undefined,game:extend(!0,{},n.game),ui:[]}}};SCG.AI.initialize=function(){SCG.AI.worker&&(SCG.AI.worker.terminate(),SCG.AI.worker=undefined,URL.revokeObjectURL(SCG.AI.blobURL));var n=SCG.scenes.activeScene.game;n&&n.AI&&(SCG.AI.blobURL=URL.createObjectURL(new Blob(["(","function(){var queue = [];\nconsole.log('worker start');\nvar queueProcesser =\n"+(n.AI.queueProcesser!=undefined&&isFunction(n.AI.queueProcesser)?n.AI.queueProcesser.toString():"function(){}")+"\nfunction processMessageQueue(){\nif(queue.length > 0){\nqueueProcesser();\n}\nsetTimeout(processMessageQueue, 100);\n}\nself.onmessage = function(e){\nvar msg = e.data;\nswitch(msg.command){\ncase 'event':\nqueue.push(msg.event);\nbreak;\ncase 'initialize':\nself.environment=msg.environment;\nqueue.push({type: 'start', message: undefined})\nbreak;\ndefault:\nbreak;\n}\n}\nprocessMessageQueue();\n}",")()"],{type:"application/javascript"})),SCG.AI.worker=new Worker(SCG.AI.blobURL));SCG.AI.worker&&n.AI.messagesProcesser!=undefined&&isFunction(n.AI.messagesProcesser)&&(SCG.AI.worker.onmessage=function(t){n.AI.messagesProcesser(t.data)})};SCG.AI.initializeEnvironment=function(n){SCG.AI.worker.postMessage({command:"initialize",environment:n})};SCG.AI.sendEvent=function(n){SCG.AI.worker.postMessage({command:"event",event:n})};SCG.UI={initialized:!1,invalidate:function(){SCG.contextUI.clearRect(0,0,SCG.viewfield.width,SCG.viewfield.height);for(var n=SCG.scenes.activeScene,t=n.ui.length;t--;)n.ui[t].update(),n.ui[t].render()},addDefaultUIButtons:function(){var n=SCG.GO.create("button",{position:new Vector2,isFullscreen:!1,transparency:.75,handlers:{click:function(){return this.isFullscreen=!this.isFullscreen,screenfull.toggle(document.documentElement),{preventBubbling:!0}}},internalUpdate:function(){var n=this.size;this.innerCanvasContext.clearRect(0,0,n.x,n.y);drawFigures(this.innerCanvasContext,this.isFullscreen?[[new Vector2(0,n.y*.475),new Vector2(n.x*.475,0),new Vector2(n.x*.475,n.y*.475)],[new Vector2(n.x*.525,n.y*.525),new Vector2(n.x,n.y*.525),new Vector2(n.x*.525,n.y)]]:[[new Vector2(0,0),new Vector2(n.x*.75,0),new Vector2(0,n.y*.75)],[new Vector2(n.x*.25,n.y),new Vector2(n.x,n.y),new Vector2(n.x,n.y*.25)]],this.transparency)}}),t;n.position=new Vector2(SCG.viewfield.width-n.size.x/2,SCG.viewfield.height-n.size.y/2);SCG.scenes.activeScene.ui.push(n);t=SCG.GO.create("button",{position:new Vector2,transparency:.75,handlers:{click:function(){return SCG.gameLogics.pauseToggle(),{preventBubbling:!0}}},internalUpdate:function(){var n=this.size;this.innerCanvasContext.clearRect(0,0,n.x,n.y);drawFigures(this.innerCanvasContext,SCG.gameLogics.isPaused?[[new Vector2(n.x*.2,0),new Vector2(n.x*.8,n.y*.5),new Vector2(n.x*.2,n.y)]]:[[new Vector2(n.x*.2,0),new Vector2(n.x*.4,0),new Vector2(n.x*.4,n.y),new Vector2(n.x*.2,n.y)],[new Vector2(n.x*.6,0),new Vector2(n.x*.8,0),new Vector2(n.x*.8,n.y),new Vector2(n.x*.6,n.y)]],this.transparency)}});t.position=new Vector2(SCG.viewfield.width-n.size.x-t.size.x/2,SCG.viewfield.height-t.size.y/2);SCG.scenes.activeScene.ui.push(t)},initialize:function(){if(!this.initialized)for(var n=0;n<this.controls.length;n++)SCG.GO.register(this.controls[n].type,this.controls[n])}};SCG.UI.controls=[{type:"button",size:new Vector2(50,50),isCustomRender:!0,innerCanvas:undefined,transparency:1,ui:!0,initializer:function(n){n.isCustomRender&&(n.innerCanvas=document.createElement("canvas"),n.innerCanvas.width=n.size.x,n.innerCanvas.height=n.size.y,n.innerCanvasContext=n.innerCanvas.getContext("2d"))},customRender:function(){SCG.contextUI.drawImage(this.innerCanvas,this.renderPosition.x-this.renderSize.x/2,this.renderPosition.y-this.renderSize.y/2,this.renderSize.x,this.renderSize.y)}}];SCG.UI.initialize();SCG.audio={context:undefined,oscillator:undefined,gainNode:undefined,currentNote:undefined,queues:[],queueCurrentIndex:-1,noteCurrentIndex:-1,loop:!0,pause:!1,notes:{dur:{whole:1e3,half:500,quarter:250,eight:125,sixteenth:62.5,thirtySecond:31.25},o1:{c:261.63,c_sh:277.18,d:293.66,d_sh:311.13,e:329.63,f:349.23,f_sh:369.99,g:392,g_sh:415.3,a:440,h_fl:466.16,h:493.88},o2:{c:523.25,c_sh:554.36,d:587.32,d_sh:622.26,e:659.26,f:698.46,f_sh:739.98,g:784,g_sh:830.6,a:880,h_fl:932.32,h:987.75}},notesChangeTimer:{ignorePause:!0,lastTimeWork:new Date,delta:0,currentDelay:0,originDelay:0,doWorkInternal:undefined,context:undefined},init:function(){if(this.queues.length!=0){try{window.AudioContext=window.AudioContext||window.webkitAudioContext;this.context=new AudioContext}catch(n){alert("Web Audio API is not supported in this browser")}this.context!=undefined&&(this.oscillator=this.context.createOscillator(),this.gainNode=this.context.createGain(),this.oscillator.connect(this.gainNode),this.gainNode.connect(this.context.destination),this.oscillator.type="triangle",this.oscillator.frequency.value=0,this.oscillator.detune.value=100,this.gainNode.gain.value=.1,this.notesChangeTimer.doWorkInternal=this.noteChange,this.notesChangeTimer.context=this,this.setValues(this.queues[this.queueCurrentIndex][this.noteCurrentIndex]),this.oscillator.start(0))}},addToQueue:function(n){if(!isArray(n)||n.length==0)throw"Notes array is empty!";this.queues.push(n);this.queueCurrentIndex=0;this.noteCurrentIndex=0},playPause:function(){this.oscillator&&(this.pause=!this.pause,this.pause?this.gainNode.disconnect(this.context.destination):this.gainNode.connect(this.context.destination))},update:function(n){this.oscillator&&doWorkByTimer(this.notesChangeTimer,n)},noteChange:function(){var n=this.queues[this.queueCurrentIndex];this.noteCurrentIndex==n.length-1?(this.queueCurrentIndex==this.queues.length-1?this.queueCurrentIndex=0:this.queueCurrentIndex++,n=this.queues[this.queueCurrentIndex],this.noteCurrentIndex=0):this.noteCurrentIndex++;this.setValues(n[this.noteCurrentIndex])},setValues:function(n){this.oscillator.frequency.value=n.value;this.notesChangeTimer.originDelay=n.duration;this.notesChangeTimer.currentDelay=n.duration}};SCG.start=function(){SCG.canvasBg||(SCG.canvasBg=appendDomElement(document.body,"canvas",{width:SCG.viewfield.width,height:SCG.viewfield.height,id:SCG.canvasBgId,css:{"z-index":0,position:"absolute"}}),SCG.contextBg=SCG.canvasBg.getContext("2d"));SCG.canvas||(SCG.canvas=appendDomElement(document.body,"canvas",{width:SCG.viewfield.width,height:SCG.viewfield.height,id:SCG.canvasId,css:{"z-index":1,position:"absolute"}}),SCG.context=SCG.canvas.getContext("2d"));SCG.canvasUI||(SCG.canvasUI=appendDomElement(document.body,"canvas",{width:SCG.viewfield.width,height:SCG.viewfield.height,id:SCG.canvasUIId,css:{"z-index":2,position:"absolute"}}),SCG.contextUI=SCG.canvasUI.getContext("2d"));SCG.initializer(function(){SCG.space==undefined&&(SCG.space={width:SCG.viewfield.default.width,height:SCG.viewfield.default.height});SCG.viewfield.current=new Box(new Vector2,new Vector2(SCG.viewfield.width,SCG.viewfield.height));SCG.gameControls.orientationChangeEventInit();SCG.customInitialization();SCG.UI.invalidate();SCG.audio&&SCG.audio.init();SCG.animate()})};SCG.preMainWork=function(){};SCG.afterMainWork=function(){};SCG.animate=function(){SCG.draw();requestAnimationFrame(SCG.animate)};SCG.draw=function(){var i,n,t,r;if(SCG.scenes.activeScene==undefined||SCG.scenes.activeScene.go==undefined)throw"Active scene corrupted!";for(i=new Date,SCG.gameLogics.doPauseWork(i),n=SCG.scenes.activeScene,n.preMainWork&&isFunction(n.preMainWork)&&n.preMainWork(),SCG.gameControls.camera.update(i),t=n.go.length;t--;)n.go[t].update(i),n.go[t].render(),n.go[t].renderPosition!=undefined&&SCG.frameCounter.visibleCount++,n.go[t].alive||(r=n.go.splice(t,1));n.afterMainWork&&isFunction(n.afterMainWork)&&n.afterMainWork();SCG.gameLogics.isPausedStep&&(SCG.gameLogics.isPausedStep=!1);SCG.frameCounter.doWork(i);SCG.audio&&SCG.audio.update(i)};document.addEventListener("DOMContentLoaded",function(){SCG.src={flower_sheet:"content/images/flower_sheet.png",butterfly_sheet:"content/images/butterfly_sheet.png",grassBackground:"content/images/grassBackground.png"};var n={name:"demo1",start:function(){this.game.AI.initialize();this.go=[];var n=SCG.GO.create("butterfly",{position:new Vector2(200,200)});this.go.push(n);this.game.playerUnit=n},backgroundRender:function(){SCG.images.grassBackground!=undefined&&SCG.contextBg.drawImage(SCG.images.grassBackground,0,0,SCG.viewfield.width,SCG.viewfield.height)},preMainWork:function(){SCG.context.clearRect(0,0,SCG.viewfield.width,SCG.viewfield.height)},game:{playerUnit:undefined,clickHandler:function(n){this.playerUnit.setDestination(n)},AI:{initialize:function(){SCG.AI.initializeEnvironment({space:{width:SCG.space.width,height:SCG.space.height},flowers:{items:[],maxCount:5}})},messagesProcesser:function(n){var r,t,o,u;if(n!=undefined&&n.command)switch(n.command){case"log":console.log(n);break;case"create":if(n.message.goType=="flower"){for(var f=!1,e=0,i=new Vector2(getRandomInt(15,SCG.space.width-15),getRandomInt(15,SCG.space.height-15));!f;){if(e>10)break;for(r=!1,t=0,o=SCG.scenes.activeScene.go.length;t<o;t++)if(u=SCG.scenes.activeScene.go[t],i.distance(u.position)<u.size.x){e++;i=new Vector2(getRandomInt(15,SCG.space.width-15),getRandomInt(15,SCG.space.height-15));r=!0;break}f=!r}SCG.scenes.activeScene.go.push(SCG.GO.create("flower",{position:i}))}}},queueProcesser:function(){for(var n,t;queue.length;){n=queue.pop();switch(n.type){case"start":self.createFlower=function(){self.postMessage({command:"create",message:{goType:"flower"}})};self.checkFlowers=function(){self.environment.flowers.items.length<self.environment.flowers.maxCount&&self.createFlower()};self.checkFlowers();break;case"created":n.message.goType=="flower"&&(self.environment.flowers.items.push({id:n.message.id,position:n.message.position}),self.checkFlowers());break;case"removed":n.message.goType=="flower"&&(t=self.environment.flowers.items.map(function(n){return n.id}).indexOf(n.message.id),t>-1&&(self.environment.flowers.items.splice(t,1),self.checkFlowers()))}}}}},gameObjectsBaseProperties:[{type:"butterfly",size:new Vector2(20,20),speed:2,imgPropertyName:"butterfly_sheet",isAnimated:!0,animation:{totalFrameCount:34,framesInRow:12,framesRowsCount:3,frameChangeDelay:50,destinationFrameSize:new Vector2(70,65),sourceFrameSize:new Vector2(70,65),loop:!0},internalUpdate:function(){for(var n,t=0,i=SCG.scenes.activeScene.go.length;t<i;t++)n=SCG.scenes.activeScene.go[t],n.type=="flower"&&n.renderBox!=undefined&&n.renderBox.isPointInside(this.renderPosition)&&n.setDead()}},{type:"flower",size:new Vector2(20,20),isOpened:!1,isCustomRender:!1,defaultDelay:3e3,isAnimated:!0,imgPropertyName:"flower_sheet",animation:{totalFrameCount:17,framesInRow:17,framesRowsCount:1,frameChangeDelay:50,destinationFrameSize:new Vector2(50,37),sourceFrameSize:new Vector2(50,37),loop:!1,reverse:!1,animationEndCallback:function(){this.animation.paused=!0}},customRender:function(){SCG.context.beginPath();SCG.context.rect(this.renderPosition.x-this.renderSize.x/2,this.renderPosition.y-this.renderSize.y/2,this.renderSize.x,this.renderSize.y);SCG.context.fillStyle=this.isOpened?"green":"gray";SCG.context.fill()},openCloseSwitch:function(){this.isOpened=!this.isOpened;this.animation.paused=!1;this.animation.reverse=this.isOpened},internalPreUpdate:function(n){doWorkByTimer(this.openCloseTimer,n)},initializer:function(n){n.openCloseTimer==undefined&&(n.openCloseTimer={lastTimeWork:new Date,delta:0,currentDelay:n.defaultDelay,originDelay:n.defaultDelay,doWorkInternal:n.openCloseSwitch,context:n})}}],gameObjectGenerator:function(){return[]}};SCG.space={width:SCG.viewfield.default.width,height:SCG.viewfield.default.height};SCG.scenes.registerScene(n);SCG.scenes.selectScene(n.name);SCG.start()});